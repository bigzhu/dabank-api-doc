![logo](./LOGO.svg)


# Dabank

Dabank is a commercial cloud-based white-labeled cryptocurrency wallet service,
supporting a wide range of coins.

With Dabank API, you are able to provide your customers with deposit,
vault and withdrawal with grace.

# Summary

## Communication

You ("app") and Dabank communicate in a bi-directional way:

* You call APIs to apply for deposit address, trigger a withdrawal, etc
* Dabank calls back to you for transaction status update, like new deposit arrival, deposit confirmation, withdrawal confirmation, etc

## Data Type

Data of input and output only consists of following basic type:

* string - most data type in use (mind all numbers(int/float) are represented in string format)

Array and Object are used on top of basic type.

## Request

All APIs uses http POST method, with `Content-Type`header `application/json; charset=utf-8`.

## Authentication

For every API following, these inputs are needed in request for authentication:

| key           | type     | comment            |
| ------------ | ------ | ------------- |
| key          | string | key provides identity       |
| sign         | string | HMAC-style data signature    |
| request_time | string | current unix second |

Steps to generate `sign`:

1. extract all values except `sign` in JSON's key-value pair to array `values`;
1. put your secret(got from control panel of Dabank) into `values`;
1. sort `values` in lexical order;
1. join `values` with underline `_` to obtain string `content`;
1. calculate md5 of `content` and you get `sign` of your current request.

documentations on above-mentioned authentication input are omitted
from now on for brevity. 

## Response

All responses are boxed in following object:

| key           | type     | comment            |
| ---------- | --------------- | ------------------------ |
| err_code   | string          | code of error, empty when everything is fine |
| err_info   | string          | description for error |
| request_id | int     | id for request booking, 0 if it is not booked   |
| data       | object/array | output of API         |

Example:

```json
{ 
    "err_code": "ERR_ACCT_NOT_EXIST",
    "err_info": "account not exist, check your key",
    "data":null
}
```

##  Param Style

key of JSON in request and response are in lower snake case, like `snake_case`.

# APIs

API is hosted at `htts://api.dabank.io/`.

## Deposit Address Application

```
/api/v3/address
```

* request:

| key      | type     |  compulsory  | comment   |
| ------- | ------ | ---- | ---- |
| symbol  | string | ✓    | symbol for coin type identification   |
| user_id | string | ✓    | unique id to distinguish user, needs to be the same for one specific user |

```json
{  
   "key":"your_api_id",
   "request_time":"1524290015",
   "sign":"data_signature",
   "symbol":"BTC",
   "user_id":"1234"
}
```

response:

| key           | type     | comment            |
| ------- | ------ | ---- |
| address | string | address for deposit   |

```json
{
   "err_code":"",
   "err_info":"",
   "data":{  
      "address":"0x12345678910388342390012323"
   },
   "request_id":233049
}
```

## Trigger a withdrawal

```
/api/v3/transfer
```

* request:

| key      | type     |  compulsory  | comment   |
| --------- | ------ | ---- | ---------------------------------------- |
| symbol    | string | ✓    | symbol for coin type identification  |
| coins     | string | ✓    | amount to withdraw  |
| to        | string | ✓    | destination address |
| from      | string | ✓    | deposit address of the user withdrawing |
| unique_id | string | ✓    | generated by you, unique for one specific transaction, use the same one if you are re-try this withdraw for some reason |

```json
{  
   "unique_id":"must_be_unique_use_the_same_one_when_retrying",
   "to":"0x12345678910388342390012323",
   "sign":"data_signature",
   "coins":"2.12345678",
   "symbol":"ETH",
   "from":"0xabc45678910388342390012323",
   "request_time":"1524298182",
   "key":"your_api_id"
}
```

response:

| key           | type     | comment            |
| ----------- | ------ | ---------------------------------------- |
| transfer_id | string | internal transaction ID provided by Dabank  |
| status      | string | TRANSFER_SUCCESSFUL/TRANSFER_PENDING |



```json
{  
   "err_code":"",
   "err_info":"",
   "data":{  
      "status":"TRANSFER_PENDING",
      "transfer_id":123
   },
   "request_id":233114
}
```


## 成功账单查询

[htts://api.dabank.io/api/v3/transfers/success](htts://api.dabank.io/api/v3/transfers/success)

request POST:

| 名称            | 类型     | 必传   | 说明                  |
| ------------- | ------ | ---- | ------------------- |
| transfer_type | string | ✓    | 交易类型 IN(转入) OUT(转出) |
| symbol        | string | ✓    | 币种                  |
| limit         | string | ✓    | 一页几条                |
| p             | string | ✓    | 第几页                 |
| start_at      | string | ✗    | 开始时间(可选)            |
| end_at        | string | ✗    | 结束时间(可选)            |
| address       | string | ✗    | 转入地址(可选)            |

若要限定时间, start_at 与 end_at 必须同时传入, 否则当做未传入处理
```json
{  
   "key":"your_api_id",
   "request_time":"1524290015",
   "sign":"data_signature",
   "transfer_type":"OUT",
   "symbol":"ETH",
   "limit":"20",
   "p":"1",
   "start_at":"1522553241",
   "end_at":"1524539191",
   "address":"0x12345678910388342390012323"
}
```

response:

| 名称        | 类型     | 说明                    |
| --------- | ------ | --------------------- |
| total     | string | 总共几条                  |
| transfers | Array  | 账单列表, 里面存放 transer 对象 |

transer 对象结构: 

| 名称           | 类型     | 说明              |
| ------------ | ------ | --------------- |
| transfer_id  | string | 交易id            |
| symbol       | string | 币种              |
| to           | string | 转入地址            |
| from         | string | 转出地址            |
| coins        | string | 转账币数. 精度为小数点后8位 |
| confirmed_at | string | 交易完成时间          |
| tx_id        | string | 链上交易的唯一标示       |
| fee          | string | 手续费             |

```json
{  
   "total":"202",
   "transfers":[
    {
     "transfer_id":"123",
     "symbol":"ETH",
     "to":"0x12345678910388342390012323",
     "from":"0x12345678910388342390012321",
     "coins":"2.54957926",
     "confirmed_at":"1524539191",
     "tx_id":"0x4ce2767bb3d039a5c62860cf51aec489ab1e287e62e9c60d1723186aee105bc7",
     "fee":"0.001"
    },
     {
     "transfer_id":"124",
     "symbol":"ETH",
     "to":"0x12345678910388342390012323",
     "from":"0x12345678910388342390012321",
     "coins":"3.2326",
     "confirmed_at":"1524539191",
     "tx_id":"0x4ce2767bb3d039a5c62860cf51aec489ab1e287e62e9c60d1723186aee105bc7",
     "fee":"0.001"
    },
  ]
}
```

## 在途账单查询

[htts://api.dabank.io/api/v3/transfers/pending](htts://api.dabank.io/api/v3/transfers/pending)

request POST:

| 名称            | 类型     | 必传   | 说明                  |
| ------------- | ------ | ---- | ------------------- |
| transfer_type | string | ✓    | 交易类型 IN(转入) OUT(转出) |
| symbol        | string | ✓    | 币种                  |
| limit         | string | ✓    | 一页几条                |
| p             | string | ✓    | 第几页                 |
| start_at      | string | ✗    | 开始时间(可选)            |
| end_at        | string | ✗    | 结束时间(可选)            |
| address       | string | ✗    | 转入地址(可选)            |

若要限定时间, start_at 与 end_at 必须同时传入, 否则当做未传入处理

```json
{  
   "key":"your_api_id",
   "request_time":"1524290015",
   "sign":"data_signature",
   "transfer_type":"OUT",
   "symbol":"ETH",
   "limit":"20",
   "p":"1",
   "start_at":"1522553241",
   "end_at":"1524539191",
   "address":"0x12345678910388342390012323"
}
```


response:

| 名称        | 类型     | 说明                    |
| --------- | ------ | --------------------- |
| total     | string | 总共几条                  |
| transfers | Array  | 账单列表, 里面存放 transer 对象 |

transer 对象结构: 

| 名称          | 类型     | 说明              |
| ----------- | ------ | --------------- |
| transfer_id | string | 交易id            |
| symbol      | string | 币种              |
| to          | string | 转入地址            |
| from        | string | 转出地址            |
| coins       | string | 转账币数. 精度为小数点后8位 |
| transfer_at | string | 交易发起时间          |
| fee         | string | 手续费             |
| confirms    | string | 当前确认数           |

```json
{  
   "total":"32",
   "transfers":[
    {
     "transfer_id":"123",
     "symbol":"ETH",
     "to":"0x12345678910388342390012323",
     "from":"0x12345678910388342390012321",
     "coins":"2.54957926",
     "transfer_at":"1524539191",
     "fee":"0.001",
     "confirms":"1"
    },
    {
     "transfer_id":"124",
     "symbol":"ETH",
     "to":"0x12345678910388342390012323",
     "from":"0x12345678910388342390012321",
     "coins":"3.2326",
     "transfer_at":"1524539191",
     "fee":"0.001",
     "confirms":"1"
   }
  ]
}
```
## 账单总和

[htts://api.dabank.io/api/v3/transfers/sum](htts://api.dabank.io/api/v3/transfers/sum)

request POST:

| 名称            | 类型     | 必传   | 说明                  |
| ------------- | ------ | ---- | ------------------- |
| symbol        | string | ✓    | 币种                  |
| start_at      | string | ✗    | 开始时间(可选)            |
| end_at        | string | ✗    | 结束时间(可选)            |
| transfer_type | string | ✓    | 转账类型 IN(转入) OUT(转出) |

```json
{  
   "key":"your_api_id",
   "request_time":"1524290015",
   "sign":"data_signature",
   "symbol":"ETH",
   "start_at":"1522553241",
   "end_at":"1524539191",
   "transfer_type":"OUT"
}
```

response:

| 名称    | 类型     | 说明              |
| ----- | ------ | --------------- |
| coins | string | 转账币数. 精度为小数点后8位 |

```json
{  
   "coins":"2233.434944"
}
```

## 查询 APP 账户信息

[htts://api.dabank.io/api/v3/appAccount](htts://api.dabank.io/api/v3/appAccount)

request POST:

| 名称     | 类型     | 必传   | 说明               |
| ------ | ------ | ---- | ---------------- |
| symbol | string | ✓    | 币种(可选, 不传时查所有币种) |

```json
{  
  "key":"your_api_id",
  "request_time":"1524290015",
  "sign":"data_signature",
  "symbol":"ETH"
}
```

response:

data 里为 Array

| 名称      | 类型     | 说明            |
| ------- | ------ | ------------- |
| symbol  | string | 币种            |
| address | string | 地址            |
| balance | string | 余额. 精度为小数点后8位 |

```json
[
  {
  "symbol":"ETH",
  "address":"0x12345678910388342390012321",
  "balance":"234.5"
  },
  {
  "symbol":"BTC",
  "address":"0x123456789103883423900123242",
  "balance":"2.5"
  },
]
```

## 验证钱包地址正确性

[htts://api.dabank.io/api/v3/checkAddress](htts://api.dabank.io/api/v3/checkAddress)

request POST:

| 名称      | 类型     | 必传   | 说明   |
| ------- | ------ | ---- | ---- |
| symbol  | string | ✓    | 币种   |
| address | string | ✓    | 钱包地址 |

```json
{  
  "key":"your_api_id",
  "request_time":"1524290015",
  "sign":"data_signature",
  "symbol":"ETH",
  "address":"0x12345678910388342390012321"
}
```

response:

| 名称      | 类型     | 说明                          |
| ------- | ------ | --------------------------- |
| verify  | string | 验证结果，成功(Success)失败(Failure) |
| err_msg | string | 错误信息,verify成功时,此字段为空        |

```json
{  
  "verify":"Failure",
  "err_msg":"err info"
}
```

## 转换BCH地址

[htts://api.dabank.io/api/v3/bchAddrConvert](htts://api.dabank.io/api/v3/bchAddrConvert)

request POST:

| 名称    | 类型   | 必传 | 说明     |
| ------- | ------ | ---- | -------- |
| address | string | ✓    | BCH新版或旧版地址 |

```json
{  
  "key":"your_api_id",
  "request_time":"1524290015",
  "sign":"data_signature",
  "address":"1BpEi6DfDAUFd7GtittLSdBeYJvcoaVggu"
}
```

response:

| 名称    | 类型   | 说明                                 |
| ------- | ------ | ------------------------------------ |
| legacy_addr  | string | 旧版BCH钱包地址（类似于比特币） |
| cash_addr | string | 新版BCH钱包地址（以`bitcoincash:`开头，请注意，`bitcoincash:`是地址的一部分）   |

```json
{  
  "legacy_addr":"1BpEi6DfDAUFd7GtittLSdBeYJvcoaVggu",
  "cash_addr":"bitcoincash:qpm2qsznhks23z7629mms6s4cwef74vcwvy22gdx6a"
}
```

#  

# 回调

以下三种情况, 会回调接口进行通知:

* 转出, 确认数变化
* 转出, 转账成功后
* 转入

request POST:

| 名字            | 类型     | 说明                                       |
| ------------- | ------ | ---------------------------------------- |
| transfer_id   | string | 交易id                                     |
| symbol        | string | 币种                                       |
| confirms      | string | 确认数(仅 TRANSFER_PENDING 状态有效)             |
| tx_id         | string | txid                                     |
| transfer_at   | string | 交易发起时间                                   |
| confirm_at    | string | 交易确认时间                                   |
| status        | string | TRANSFER_SUCCESSFUL(成功) TRANSFER_PENDING(在途) |
| transfer_type | string | 转账类型 IN(转入) OUT(转出)                      |
| to            | string | 转入地址                                     |
| from          | string | 转出地址, 类型为转入(IN)时可能为空                     |
| coins         | string | 转账币数. 精度为小数点后8位                          |
| fee           | string | 手续费                                      |
| fee_symbol    | string | 手续费扣费币种                                  |

* 转出, 确认数变化

```json
{  
   "transfer_id":"1365850",
   "symbol":"BTC",
   "tx_id":"7cee2e2055c85d40ab27f713d1bbcd7db2d07a8ab54483e7c423ed6cdc689007",
   "confirms":"2",
   "transfer_at":"1524298179",
   "confirm_at":"1524299426",
   "transfer_type":"OUT",
   "status":"TRANSFER_PENDING",
   "to":"1A3x2pU6gJKJAzc6XiZHKLhkBWSH6QkQo8",
   "from":"1G2BLexgX5dYwuzagBuSEp43Wy7Jgmm1mw",
   "coins":"2.73604069",
   "fee":"0.001",
   "fee_symbol":"BTC",
   "request_time":"1524299426",
   "key":"your_api_id",
   "sign":"123"
}
```
* 转出, 转账成功后

```json
{  
   "transfer_id":"1365848",
   "symbol":"MGD",
   "tx_id":"bc2929b14ea303e198517d1550e30e1b8125f5f16fb373f7407f8a48cf605c7a",
   "confirms":"3",
   "transfer_at":"1524293497",
   "confirm_at":"1524294491",
   "transfer_type":"OUT",
   "status":"TRANSFER_SUCCESSFUL",
   "to":"MHBLixzhMs4RCfudx2jttU1SesxkjLxUrF",
   "from":"MPfFsz7GTSi4vQ5XEbMVRAZ67tDd6sQD21",
   "coins":"999.9",
   "fee":"0.001",
   "fee_symbol":"MGD",
   "request_time":"1524294491",
   "key":"your_api_id",
   "sign":"123"
}
```

* 转入

```json
{  
   "transfer_id":"1365849",
   "symbol":"ETH",
   "tx_id":"0x4ce2767bb3d039a5c62860cf51aec489ab1e287e62e9c60d1723186aee105bc7",
   "confirms":"13",
   "transfer_at":"1524296032",
   "confirm_at":"1524296243",
   "transfer_type":"IN",
   "status":"TRANSFER_SUCCESSFUL",
   "to":"0xc03db2681719eb3d41aa8ef5b23e11341fba57f0",
   "from":"",
   "coins":"2.997",
   "fee":"0",
   "fee_symbol":"ETH",
   "request_time":"1524296243",
   "key":"your_api_id",
   "sign":"123"
}
```

response:

接口需要按照正确格式返回成功，否则会一直重试，重试间隔时间为2的重试次数次幂，单位为秒。

| 名字     | 类型     | 说明                       |
| ------ | ------ | ------------------------ |
| result | string | 成功时为 "Success", 失败时为错误信息 |

```json
{  
   "result":"Success"
}
```

# Special Notes

针对门罗币(XMR)的特殊说明:
- 如果客户提币地址要求 address+paymenid 的形式, `to` 参数设置成 `address$payment_id` 即可， 即用`$`连接 `to` 和 `paymentid`, 例如:`9wHNWjJ1Gnw7Yw1RjDLNiJ8yJw91xFCz4NvXCcQjzceiGqFXDcXuCqPckgi7pn1LA4FZ5EaAUd19meb8GXxCp3iFT2yZViw$662f879677b96d0919db4ae069d985e5e3dcf10c8429ed395a9a6e798bb4f9d1`
- 如果不设置`paymentid`, 则不带$符号, 直接传入集成地址

# 支持的币种以及小数位数

以下数据截止2018年09月07日，共61个（币种小数位超过8位的支持到8位，低于等于8位的支持实际的小数位数）：

<table border="0" style="border-collapse:collapse; text-align: center;">
<tr><th>symbol</th><th>cn_name</th><th>decimals</th><th>token_of</th></tr>
<tr><td>BCD</td><td>Bitcoin Diamond</td><td>7</td><td>主网</td></tr>
<tr><td>BCH</td><td>比特币现金</td><td>8</td><td>主网</td></tr>
<tr><td>BTC</td><td>比特币</td><td>8</td><td>主网</td></tr>
<tr><td>DCON</td><td>DCON</td><td>0</td><td>主网</td></tr>
<tr><td>EOS(mainnet)</td><td>EOS(mainnet)</td><td>4</td><td>主网</td></tr>
<tr><td>ETH</td><td>以太坊</td><td>18</td><td>主网</td></tr>
<tr><td>LMC</td><td>邻萌宝</td><td>6</td><td>主网</td></tr>
<tr><td>LTC</td><td>莱特币</td><td>8</td><td>主网</td></tr>
<tr><td>MGD</td><td>MGD</td><td>8</td><td>主网</td></tr>
<tr><td>QTUM</td><td>量子</td><td>8</td><td>主网</td></tr>
<tr><td>TRXmain</td><td>波场主网</td><td>6</td><td>主网</td></tr>
<tr><td>WCG</td><td>WCG</td><td>8</td><td>主网</td></tr>
<tr><td>XMC</td><td>XMC</td><td>0</td><td>主网</td></tr>
<tr><td>XMR</td><td>XMR</td><td>12</td><td>主网</td></tr>
<tr><td>DRT(WCG)</td><td>DRT(WCG)</td><td>4</td><td>WCG</td></tr>
<tr><td>AIMS</td><td>HighCastle Token</td><td>8</td><td>ETH</td></tr>
<tr><td>ALI</td><td>AiLink Token</td><td>18</td><td>ETH</td></tr>
<tr><td>ANTC</td><td>AntCoin</td><td>18</td><td>ETH</td></tr>
<tr><td>BFDT</td><td>BFDToken</td><td>18</td><td>ETH</td></tr>
<tr><td>BNB</td><td>币安币</td><td>18</td><td>ETH</td></tr>
<tr><td>BTK</td><td>BitcoinToken</td><td>18</td><td>ETH</td></tr>
<tr><td>BTM</td><td>Bytom</td><td>8</td><td>ETH</td></tr>
<tr><td>CDY</td><td>CDY</td><td>8</td><td>ETH</td></tr>
<tr><td>CFUN(ERC20)</td><td>CFun Token</td><td>9</td><td>ETH</td></tr>
<tr><td>CRE</td><td>CybereitsToken</td><td>18</td><td>ETH</td></tr>
<tr><td>DKYC</td><td>Data Know Your Customer</td><td>18</td><td>ETH</td></tr>
<tr><td>EGT</td><td>Egretia</td><td>18</td><td>ETH</td></tr>
<tr><td>EGTY</td><td>EgtyChain</td><td>8</td><td>ETH</td></tr>
<tr><td>HOTC</td><td>HOTchain</td><td>18</td><td>ETH</td></tr>
<tr><td>HOTC(HOTCOIN)</td><td>HotCoin</td><td>0</td><td>ETH</td></tr>
<tr><td>HPB</td><td>HPBCoin </td><td>18</td><td>ETH</td></tr>
<tr><td>HYB</td><td>Hybrid</td><td>8</td><td>ETH</td></tr>
<tr><td>ICX</td><td>ICON</td><td>18</td><td>ETH</td></tr>
<tr><td>IDM</td><td>IDMONEY</td><td>18</td><td>ETH</td></tr>
<tr><td>IOST</td><td>IOSToken</td><td>18</td><td>ETH</td></tr>
<tr><td>JLL</td><td>JLL</td><td>18</td><td>ETH</td></tr>
<tr><td>KEY</td><td>SelfKey</td><td>18</td><td>ETH</td></tr>
<tr><td>LBA</td><td>LightBitAtom</td><td>8</td><td>ETH</td></tr>
<tr><td>LPK</td><td>Kripton</td><td>8</td><td>ETH</td></tr>
<tr><td>LRC</td><td>Loopring</td><td>18</td><td>ETH</td></tr>
<tr><td>LYS</td><td>LIGHTYEARS</td><td>8</td><td>ETH</td></tr>
<tr><td>MBC</td><td>MicroBusinessCoin</td><td>18</td><td>ETH</td></tr>
<tr><td>MOS</td><td>Moses</td><td>18</td><td>ETH</td></tr>
<tr><td>MUXE</td><td>MUXE Token</td><td>18</td><td>ETH</td></tr>
<tr><td>NRM</td><td>Neuromachine</td><td>18</td><td>ETH</td></tr>
<tr><td>POVR</td><td>POVCoin Token</td><td>18</td><td>ETH</td></tr>
<tr><td>READ</td><td>阅读币</td><td>8</td><td>ETH</td></tr>
<tr><td>RED</td><td>REDToken</td><td>18</td><td>ETH</td></tr>
<tr><td>RUFF</td><td>RUFF</td><td>18</td><td>ETH</td></tr>
<tr><td>THM</td><td>THM</td><td>18</td><td>ETH</td></tr>
<tr><td>TRUE</td><td>TRUE Token</td><td>18</td><td>ETH</td></tr>
<tr><td>USDT</td><td>Tether USD</td><td>6</td><td>ETH</td></tr>
<tr><td>USO</td><td>Ubiquity</td><td>8</td><td>ETH</td></tr>
<tr><td>VAR</td><td>Variant</td><td>18</td><td>ETH</td></tr>
<tr><td>VNS</td><td>VenusToken</td><td>18</td><td>ETH</td></tr>
<tr><td>XNS</td><td>SUNX</td><td>18</td><td>ETH</td></tr>
<tr><td>XRT</td><td>XRT Token</td><td>18</td><td>ETH</td></tr>
<tr><td>XT</td><td>XstarToken</td><td>18</td><td>ETH</td></tr>
<tr><td>ZRX</td><td>0x Protocol Token</td><td>18</td><td>ETH</td></tr>
<tr><td>ADD(EOS)</td><td>ADD(EOS)</td><td>4</td><td>EOS(mainnet)</td></tr>
<tr><td>USDT(Omni)</td><td>USDT（比特币）</td><td>8</td><td>BTC</td></tr></table>

# 版本

请参阅[提交历史](https://github.com/dabankio/dabank-api-doc/commits/master)。

